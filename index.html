<html>

<head>
  <title>Clown Diary</title>
  <link rel="stylesheet" href="index.css">
  <link rel="icon" href="alt.ico" />
  <script src="entry.js"></script>
  <script src="entries.js"></script>

  <script>
    const one_day_in_millis = 1000 * 60 * 60 * 24

    function getParameterByName(name, url) {
      if (!url) {
        url = window.location.href;
      }
      name = name.replace(/[[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }


    const renderEntry = (reference_date, days_since_last_even, parent, entry) => {
      if (entry.date >= days_since_last_even && !(getParameterByName("truth", null) )) {
       return;
      }

      const calculated_date = new Date();
      calculated_date.setDate(reference_date.getDate() + entry.date);
      calculated_date.setYear(2007)
      //JR NOTE: wasn't doing this before and it made it display wrong months in odd months
      calculated_date.setMonth(reference_date.getMonth())

      const ele = document.createElement("div");
      ele.id = "entry";
      const container = document.createElement("div");
      container.id = "container";


      const text = document.createElement("div");
      text.innerHTML = entry.text;
      text.id = "text";
      const icon = document.createElement("img");
      icon.src = entry.icon;
      icon.id = "icon";
      const title = document.createElement("h2");
      title.id = "title";
      title.innerHTML = entry.title;
      const date = document.createElement("div");
      date.id = "date";
      date.innerHTML = calculated_date.toLocaleDateString();
      const wordsContainer = document.createElement("div");
      wordsContainer.id = "words-container";

      const label = document.createElement("span");
      label.id = "label";
      label.innerHTML = `Words Of The Day:`;

      const words = document.createElement("span");
      words.id = "words";
      words.innerHTML = entry.words_of_the_day;
      wordsContainer.append(label);
      wordsContainer.append(words);

      container.append(icon);
      container.append(text);

      ele.append(title);
      ele.append(date);
      ele.append(container);

      ele.append(wordsContainer);

      parent.append(ele);
    }

    /*
      get todays' date. 
       figure out how many days its been since the first day of the last even month
       once i have that number, go through all entries
       if the entry's date is >= todays number, render it

       this should loop on a two month cycle

       the point is both to have a kind of 'dracula daily' vibe
       and so that if you visit once you're unlikely to get the full story
       or even know you're missing anything

       and if you visit later it will be DIFFERENT and you won't know why
       unless you waste
    */
    const renderEntriesTillToday = () => {

      console.log("%cJR NOTE: If you wanted to visualize our cast, I'd look here: http://farragofiction.com/TwoGayJokes/Stories/loop2_infoteamandother.png","font-weight: bold;font-family: 'Courier New', monospace;color:#06FFC9; background: #346F3F; padding:10px; border-radius: 13px; font-size:13px;");
      const parent = document.querySelector("#journal");
      const today = new Date();
      today.setHours(0); //we don't care about the hours
      //also yes its "even" by 0 index, not one. 
      //so even months should be january, march, may, july, september, november
      //this'll also prevent us from having to care about 0 minus 1 being not valid
      //since zero is even 
      let last_even_month = today.getMonth() % 2 === 0 ? today.getMonth() : today.getMonth() - 1;

      //since we KNOW that january is an even month for our purposes, we don't even have to care about year roll over
      //convinient
      const last_even_month_date_zero = new Date(today.getFullYear(), last_even_month, 1)

      const time_since_last_even_month = 1 + Math.round((today.getTime() - last_even_month_date_zero.getTime()) / one_day_in_millis);
      const reversed_entries = entries.reverse();
      for (let entry of reversed_entries) {
        renderEntry(last_even_month_date_zero, time_since_last_even_month, parent, entry);
      }
    }

    window.onload = () => {
      //todo: figure out how many days its been since the last even month
      //from that, figure out what entries should be displayed
      //loop on them to render

      renderEntriesTillToday();
    }
  </script>
</head>


<body>
  <h1 id="title">Yongiki</h1>
  <div id="journal">

  </div>

</body>

</html>